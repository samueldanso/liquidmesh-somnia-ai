# ğŸ¤– LiquidMesh Agents

**Multi-agent orchestration system for autonomous concentrated liquidity management on Somnia.**

### Core System

-   âœ… **EventBus** - Agent communication
-   âœ… **Base Agent** class - Common agent interface
-   âœ… **Memory System** - Supabase for thought persistence
-   âœ… **Mock Data** - Pool metrics, balances, positions for testing //will reppace with somnia Dexes and pools

### Three Specialized Agents

1. **Watcher Agent** - Monitors liquidity pools, generates market intelligence reports
2. **Strategist Agent** - Analyzes reports, generates optimal rebalancing strategies
3. **Executor Agent** - Executes strategies (mock tx for demo)

### API Layer

-   **Hono** server with CORS
-   **GET /thoughts** - All agent thoughts
-   **GET /thoughts/:agent** - Specific agent thoughts
-   **GET /positions** - Mock liquidity positions
-   **GET /positions/pools** - Mock pool metrics

## ğŸš€ Quick Start

### 1. Setup Supabase Database

Go to your **Supabase Dashboard** â†’ SQL Editor and run these commands:

```sql
-- Table for storing agent thoughts and tool calls
CREATE TABLE thoughts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  agent TEXT NULL,
  text TEXT NULL,
  tool_calls JSON NULL,
  tool_results JSON NULL
);

-- Table for storing reports with embeddings for semantic search
CREATE TABLE documents (
  id BIGSERIAL PRIMARY KEY,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  content TEXT,
  embedding VECTOR(1536)
);

-- Enable pgvector extension (if not already enabled)
CREATE EXTENSION IF NOT EXISTS vector;

-- Function for semantic search using embeddings
CREATE OR REPLACE FUNCTION match_documents (
  query_embedding VECTOR(1536),
  match_threshold FLOAT,
  match_count INT
)
RETURNS TABLE (
  id BIGINT,
  content TEXT,
  similarity FLOAT
)
LANGUAGE SQL STABLE
AS $$
  SELECT
    documents.id,
    documents.content,
    1 - (documents.embedding <=> query_embedding) AS similarity
  FROM documents
  WHERE 1 - (documents.embedding <=> query_embedding) > match_threshold
  ORDER BY similarity DESC
  LIMIT match_count;
$$;
```

### 2. Install Dependencies & Configure

```bash
# Install dependencies
bun install

# Set up environment (copy .env.example to .env and fill in)
cp .env.example .env

# Required in .env:
- OPENAI_API_KEY=sk-...
- SUPABASE_URL=https://your-project.supabase.co
- SUPABASE_KEY=your-anon-key
- PRIVATE_KEY=0x...
```

### 3. Run Agents

```bash
bun run dev
```

## ğŸ“Š Agent Flow & Autonomous Loop

```
Watcher â†’ Strategist â†’ Executor â†’ Strategist â†’ Watcher
   â†“          â†“           â†“              â†“
  Mock      AI          Mock       Store Report
  Data    Decision       TX          + Wait

When stable: noFurtherActionsTool â†’ Wait (configurable) â†’ Restart
```

### Periodic Execution

The agents run **autonomously** with intelligent wait times:

-   **AI-Driven:** Watcher decides when to wait using `noFurtherActionsTool`
-   **Configurable:** Set `AGENT_INTERVAL` in `.env` (default: 60000ms = 1 min)
-   **Smart:** Shorter waits for volatile markets, longer for stable conditions
-   **Gas-Efficient:** Prevents unnecessary rebalancing when positions are optimal

This prevents abuse while allowing rapid response to market changes.

## ğŸ—ï¸ File Structure

```
src/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ agent.ts              # Base agent class
â”‚   â”œâ”€â”€ index.ts              # Agent registration
â”‚   â”œâ”€â”€ watcher/              # Market monitoring
â”‚   â”œâ”€â”€ strategist/           # Strategy decisions
â”‚   â””â”€â”€ executor/             # TX execution
â”œâ”€â”€ system-prompts/           # AI behavior definitions
â”œâ”€â”€ comms/
â”‚   â””â”€â”€ event-bus.ts          # Inter-agent messaging
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ db.ts                 # Supabase persistence
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ types.ts              # Data interfaces
â”‚   â””â”€â”€ mock-pool-data.ts     # Mock DEX data
â”œâ”€â”€ routes/                   # HTTP API endpoints
â”œâ”€â”€ app.ts                    # Hono server
â”œâ”€â”€ setup.ts                  # Agent initialization
â””â”€â”€ index.ts                  # Entry point
```

## ğŸ¯ Next Steps

### For Demo

-   âœ… Agents communicate via EventBus
-   âœ… AI reasoning visible in console
-   âœ… API endpoints working
-   â³ Connect to frontend
-   â³ Add real Somnia RPC (optional)
-   â³ Real transaction execution (optional)

### Testing

```bash
bun run typecheck

# Test API
curl http://localhost:8000
curl http://localhost:8000/thoughts
curl http://localhost:8000/positions
```

## ğŸ”— Resources

-   Somnia Docs: https://docs.somnia.network
-   Vercel AI SDK: https://sdk.vercel.ai

---

**Built for Somnia AI Hackathon 2025 ğŸš€**
